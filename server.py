from web3 import Web3
import time

w3 = Web3(Web3.HTTPProvider("http://127.0.0.1:7545"))
if not w3.isConnected():
    print('[-] Connected error!')
    exit()

w3.eth.defaultAccount = w3.eth.accounts[0]

address = '0x6eAe6059E06DE916039d6027E4E674e240d5E041'
abi = '[{"anonymous":false,"inputs":[{"indexed":false,"internalType":"string","name":"fName","type":"string"},{"indexed":false,"internalType":"uint256","name":"age","type":"uint256"}],"name":"Instructor","type":"event"},{"constant":false,"inputs":[{"internalType":"string","name":"_fName","type":"string"},{"internalType":"uint256","name":"_age","type":"uint256"}],"name":"setInfo","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"getInfo","outputs":[{"internalType":"string","name":"","type":"string"},{"internalType":"uint256","name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"}]'
bytecode = '608060405234801561001057600080fd5b506103a8806100206000396000f3fe608060405234801561001057600080fd5b50600436106100365760003560e01c80635a9b0b891461003b5780638262963b146100c2575b600080fd5b61004361016c565b6040518080602001838152602001828103825284818151815260200191508051906020019080838360005b8381101561008657818101518382015260200161006e565b50505050905090810190601f1680156100b35780820380516001836020036101000a031916815260200191505b50935050505060405180910390f35b61016a600480360360408110156100d857600080fd5b8101906020810181356401000000008111156100f357600080fd5b82018360208201111561010557600080fd5b8035906020019184600183028401116401000000008311171561012757600080fd5b91908080601f0160208091040260200160405190810160405280939291908181526020018383808284376000920191909152509295505091359250610218915050565b005b6060600080600154818054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156102095780601f106101de57610100808354040283529160200191610209565b820191906000526020600020905b8154815290600101906020018083116101ec57829003601f168201915b50505050509150915091509091565b815161022b9060009060208501906102d8565b50806001819055507f010becc10ca1475887c4ec429def1ccc2e9ea1713fe8b0d4e9a1d009042f6b8e82826040518080602001838152602001828103825284818151815260200191508051906020019080838360005b83811015610299578181015183820152602001610281565b50505050905090810190601f1680156102c65780820380516001836020036101000a031916815260200191505b50935050505060405180910390a15050565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f1061031957805160ff1916838001178555610346565b82800160010185558215610346579182015b8281111561034657825182559160200191906001019061032b565b50610352929150610356565b5090565b61037091905b80821115610352576000815560010161035c565b9056fea265627a7a7231582089d2eea2ed81fdcae3e852c43c869501475a43097a5ec7fe1678ae76b87fde0c64736f6c634300050c0032'
contract = w3.eth.contract(address=address, abi=abi, bytecode=bytecode)

def handle_event(event):
    receipt = w3.eth.waitForTransactionReceipt(event['transactionHash'])
    result = contract.events.Instructor().processReceipt(receipt)
    print(result[0]['args'])

def listen(event_filter):
    while True:
        for event in event_filter.get_new_entries():
            handle_event(event)
            # SM2
            time.sleep(2)

event_filter = w3.eth.filter({'fromBlock':'latest', 'address':address})
listen(event_filter)

